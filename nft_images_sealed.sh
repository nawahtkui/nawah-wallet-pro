#!/bin/bash
# nft_images_sealed.sh
# ุณูุฑุจุช: ุถุบุท ูุชุดููุฑ ูุฌูุฏ ุตูุฑ NFT (ูุนุฏู ูุขูู)
# ูุณุงุฑุงุช ุซุงุจุชุฉ ุฏุงุฎู ูุดุฑูุนู Nawah-Wallet

# --- ุฅุนุฏุงุฏ ุงููุณุงุฑุงุช ---
IMG_DIR="$HOME/downloads/Nawah-Wallet/nft_images"
SEALED_DIR="$HOME/downloads/Nawah-Wallet/nft_images_sealed_protected"
ARCHIVE_NAME="nft_images_$(date +%Y%m%d_%H%M%S).tar.gz"
ENCRYPTED_ARCHIVE="nft_images_sealed_$(date +%Y%m%d_%H%M%S).enc"

# --- ุฅูุดุงุก ุงููุฌูุฏุงุช ุฅู ูู ุชูู ููุฌูุฏุฉ ---
mkdir -p "$IMG_DIR"
mkdir -p "$SEALED_DIR"

echo "๐ ุงููุฌูุฏุงุช:"
echo "  ุงูุตูุฑ (Input) : $IMG_DIR"
echo "  ุงููุญูู (Output): $SEALED_DIR"
echo ""

# --- ุฎุทูุฉ (ุฃ): ูุชุญ ูุฌูุฏ ุงูุตูุฑ ูุชุนุฏูู ุฃู ูุฑุงุฌุนุฉ ---
if [ -z "$(ls -A "$IMG_DIR" 2>/dev/null)" ]; then
  echo "โ๏ธ  ูุฌูุฏ ุงูุตูุฑ ูุงุฑุบ: $IMG_DIR"
  echo "ุถุน ุงูุตูุฑ ุฏุงุฎู ุงููุฌูุฏ ุซู ุฃุนุฏ ุชุดุบูู ูุฐุง ุงูุณูุฑุจุช."
  exit 1
fi

echo "โ๏ธ  ุฌุงุฑู ูุชุญ ูุฌูุฏ ุงูุตูุฑ ููุชุนุฏูู (termux-open)..."
termux-open "$IMG_DIR"
echo "โ ููููู ุงูุขู ุชุนุฏูู ุงูุตูุฑ. ุงุถุบุท [Enter] ุจุนุฏ ุงูุฅูุชูุงุก."
read -r

# --- ุฎุทูุฉ (ุจ): ุถุบุท ุงููููุงุช ---
echo "๐๏ธ  ูุชู ุถุบุท ุงูุตูุฑ ุฅูู ุฃุฑุดูู..."
tar -czf "$SEALED_DIR/$ARCHIVE_NAME" -C "$IMG_DIR" .
if [ $? -ne 0 ]; then
  echo "โ ูุดู ุถุบุท ุงูุตูุฑ. ุชุฃูุฏ ูู ูุฌูุฏ ุงููููุงุช ูุฅุนุงุฏุฉ ุงููุญุงููุฉ."
  exit 1
fi
echo "โ ุชู ุฅูุดุงุก ุงูุฃุฑุดูู: $SEALED_DIR/$ARCHIVE_NAME"

# --- ุฎุทูุฉ (ุฌ): ุทูุจ ูููุฉ ูุฑูุฑ ููุชุดููุฑ (ูุฎูู ุฃุซูุงุก ุงูุฅุฏุฎุงู) ---
echo ""
read -s -p "๐ ุฃุฏุฎู ูููุฉ ูุฑูุฑ ููุชุดููุฑ (ุณุชุญุชุงุฌูุง ููู ุงูุดูุฑุฉ): " PW
echo ""
if [ -z "$PW" ]; then
  echo "โ ูู ุชุฏุฎู ูููุฉ ูุฑูุฑ. ุฅูุบุงุก ุงูุนูููุฉ."
  rm -f "$SEALED_DIR/$ARCHIVE_NAME"
  exit 1
fi

# --- ุฎุทูุฉ (ุฏ): ุชุดููุฑ ุงูุฃุฑุดูู ุจุงุณุชุฎุฏุงู openssl (pbkdf2 ุขูู) ---
echo "๐ ุฌุงุฑู ุชุดููุฑ ุงูุฃุฑุดูู..."
openssl enc -aes-256-cbc -salt -pbkdf2 -in "$SEALED_DIR/$ARCHIVE_NAME" -out "$SEALED_DIR/$ENCRYPTED_ARCHIVE" -pass pass:"$PW"
if [ $? -ne 0 ]; then
  echo "โ ูุดู ุงูุชุดููุฑ ุนุจุฑ openssl."
  # ุฅุฒุงูุฉ ุงูุฃุฑุดูู ุบูุฑ ุงููุดููุฑ ุฅู ุฑุบุจุช
  rm -f "$SEALED_DIR/$ARCHIVE_NAME"
  exit 1
fi

# --- ุฎุทูุฉ (ูู): ุชูุธูู (ุญุฐู ุงูุฃุฑุดูู ุบูุฑ ุงููุดููุฑ) ---
rm -f "$SEALED_DIR/$ARCHIVE_NAME"
echo "โ ุชู ุงูุชุดููุฑ ูุงูุญุฐู ุงูุขูู ููุฃุฑุดูู ุบูุฑ ุงููุดููุฑ."

# --- ุฎุทูุฉ (ู): ูุชุญ ูุฌูุฏ ุงููุชูุฌุฉ ูุฅุธูุงุฑ ุงููุณุงุฑ ---
echo ""
echo "๐ ุงููุฌูุฏ ุงููุญูู:"
ls -l "$SEALED_DIR"
termux-open "$SEALED_DIR"

echo ""
echo "๐ ุงูุชููุช ุงูุนูููุฉ. ููู ูุดููุฑ: $SEALED_DIR/$ENCRYPTED_ARCHIVE"
echo "โ ุงุญุชูุธ ุจูููุฉ ุงููุฑูุฑ ุงูุชู ุฃุฏุฎูุชูุง ููู ุงูุชุดููุฑ ูุงุญููุง."
