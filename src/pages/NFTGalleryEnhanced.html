<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>معرض NFTs | Nawah Wallet</title>
  <link rel="stylesheet" href="NFTGalleryEnhanced.css" />
</head>
<body>
  <header>
    <h1>🪙 معرض نواة NFT</h1>
    <p>استعرض رموزك الفريدة من مشروع نواة مباشرة عبر واجهة المحفظة</p>
  </header>

  <section class="controls">
    <input type="text" id="searchBox" placeholder="🔍 ابحث عن NFT بالاسم..." />
    <select id="rarityFilter">
      <option value="">كل الندرات</option>
      <option value="legendary">أسطوري</option>
      <option value="rare">نادر</option>
      <option value="common">عادي</option>
    </select>
    <button id="refreshBtn">🔄 تحديث البيانات</button>
  </section>

  <main class="container">
    <div id="gallery" class="grid"></div>
  </main>

  <!-- Lightbox -->
  <div id="lightbox">
    <img id="lbimg" src="" alt="NFT Full View" />
  </div>

  <script>
    // تحميل بيانات NFTs من ملف JSON
    async function loadNFTs() {
      const response = await fetch('nft_frontend.json');
      const data = await response.json();
      return data;
    }

    function renderGallery(nfts) {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      nfts.forEach(nft => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${nft.image}" alt="${nft.name}" class="thumb" onclick="openLightbox('${nft.image}')">
          <div class="meta">
            <h3>${nft.name}</h3>
            <div class="desc">${nft.description || 'رمز رقمي فريد من نواة'}</div>
            <div class="row">
              <span class="badge ${nft.rarity || 'common'}">${nft.rarity || 'غير محدد'}</span>
              <span>الندرة</span>
            </div>
            <div class="row">
              <span>🔢 المعرف:</span>
              <span>#${nft.id}</span>
            </div>
            <div class="actions">
              <button class="action-btn" onclick="copyMetadata(${nft.id})">📋 نسخ البيانات</button>
              <button class="action-btn" onclick="viewOnchain(${nft.id})">🔗 على البلوكشين</button>
            </div>
          </div>
        `;
        gallery.appendChild(card);
      });
    }

    function openLightbox(imgSrc) {
      const lb = document.getElementById('lightbox');
      const lbimg = document.getElementById('lbimg');
      lbimg.src = imgSrc;
      lb.classList.add('open');
    }

    document.getElementById('lightbox').addEventListener('click', () => {
      document.getElementById('lightbox').classList.remove('open');
    });

    function copyMetadata(id) {
      navigator.clipboard.writeText(`NFT ID: ${id}`).then(() => {
        alert('✅ تم نسخ معرف الـNFT إلى الحافظة');
      });
    }

    function viewOnchain(id) {
      const url = `https://testnet.bscscan.com/token/<YOUR_CONTRACT_ADDRESS>?a=${id}`;
      window.open(url, '_blank');
    }

    // وظائف البحث والتصفية
    function applyFilters(nfts) {
      const searchTerm = document.getElementById('searchBox').value.toLowerCase();
      const rarity = document.getElementById('rarityFilter').value;
      return nfts.filter(nft =>
        (!searchTerm || nft.name.toLowerCase().includes(searchTerm)) &&
        (!rarity || nft.rarity === rarity)
      );
    }

    // تحميل وتحديث
    let nftData = [];
    async function initGallery() {
      nftData = await loadNFTs();
      renderGallery(nftData);
    }

    document.getElementById('refreshBtn').addEventListener('click', () => {
      const filtered = applyFilters(nftData);
      renderGallery(filtered);
    });

    document.getElementById('searchBox').addEventListener('input', () => {
      const filtered = applyFilters(nftData);
      renderGallery(filtered);
    });

    document.getElementById('rarityFilter').addEventListener('change', () => {
      const filtered = applyFilters(nftData);
      renderGallery(filtered);
    });

    initGallery();
  </script>
</body>
</html>
